import{r as c,b as m,j as e,A as k,c as u,C as p}from"./index-405c3300.js";import{B as n}from"./supabaseClient-ffb8bf18.js";import{D,a as o,b as y,c as U,d as E,f as I,C as S,I as T,e as A,g as z}from"./ReadmeBtn-1ddad441.js";import{b as B}from"./utils-550eb278.js";import{u as F}from"./iconBase-242064ed.js";import{u as H}from"./useDispatch-53d3544d.js";import"./index.esm-37c53e07.js";function L({open:x,map:a,onClose:r,onUploaded:h}){const{t}=F(),[f,g]=c.useState(""),[j,N]=c.useState(!1),{mymaps:d}=m(s=>s.maps),{user:i}=m(s=>s.user),C=async()=>{const s=await z(a,i);k.success("上傳完成"),l(u(s.data.map)),h(s.data.map)};c.useEffect(()=>{N((()=>i.id?a.mid?!1:a.owner?a.owner===i.id:!0:!1)())},[a,i]);const l=H(),b=()=>{const s={name:a.name,data:a.data,id:Date.now()};l(p([...d,s])),r()},w=()=>{const s=B(a);s.name=f,l(u(s)),r()},v=()=>{const s=d.filter(M=>M.id!==a.id);l(p(s)),r()};return e.jsxs(D,{open:x,children:[e.jsx(o,{asChild:!0,children:e.jsx(n,{className:"w-full rounded-none bg-slate-600 text-white",children:t("common.edit")})}),e.jsxs(y,{className:"modalContent","aria-describedby":void 0,children:[e.jsx(U,{children:e.jsx(E,{children:t("common.edit")+t("common.map")})}),e.jsxs(I,{onClick:r,className:"absolute z-50 right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(o,{asChild:!0,children:e.jsx(n,{variant:"outline",className:"grow shrink-0",type:"submit",onClick:b,children:t("mapUpload.saveAs")})}),j&&e.jsx(o,{asChild:!0,children:e.jsx(n,{variant:"outline",className:"grow shrink-0",type:"submit",onClick:C,children:t("common.upload")+t("common.map")})})]}),a.uuid&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:"地圖UUID:"}),e.jsx("p",{className:"text-xs",children:a.uuid})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:t("common.map")+t("common.name")}),e.jsx(T,{id:"mapName",defaultValue:a.name,onChange:s=>g(s.target.value),className:"w-full"})]}),e.jsxs(A,{className:"w-full flex flex-row flex-nowrap items-center",children:[e.jsx(o,{asChild:!0,children:e.jsx(n,{className:"w-[90px] shrink-0 mr-8 text-red-700 hover:text-red-500",variant:"ghost",size:"sm",onClick:v,children:t("common.delete")+t("common.map")})}),e.jsx(o,{asChild:!0,children:e.jsx(n,{className:"grow shrink-0",type:"submit",onClick:w,children:t("common.save")})})]})]})]})}export{L as default};
