import{r as c,b as m,j as e,J as k,c as u,C as p}from"./index-8a1d3cca.js";import{B as n}from"./supabaseClient-40abd7ef.js";import{D,a as o,b as y,c as U,d as E,f as I,C as S,I as T,e as z,g as B}from"./ReadmeBtn-c6e4c2e1.js";import{b as J}from"./utils-30caca54.js";import{u as A}from"./iconBase-74b0cd5c.js";import{u as F}from"./useDispatch-76832de9.js";import"./index.esm-fdfbfd57.js";function L({open:x,map:a,onClose:r,onUploaded:h}){const{t}=A(),[f,g]=c.useState(""),[j,N]=c.useState(!1),{mymaps:d}=m(s=>s.maps),{user:i}=m(s=>s.user),C=async()=>{const s=await B(a,i);k.success("上傳完成"),l(u(s.data.map)),h(s.data.map)};c.useEffect(()=>{N((()=>i.id?a.mid?!1:a.owner?a.owner===i.id:!0:!1)())},[a,i]);const l=F(),b=()=>{const s={name:a.name,data:a.data,id:Date.now()};l(p([...d,s])),r()},w=()=>{const s=J(a);s.name=f,l(u(s)),r()},v=()=>{const s=d.filter(M=>M.id!==a.id);l(p(s)),r()};return e.jsxs(D,{open:x,children:[e.jsx(o,{asChild:!0,children:e.jsx(n,{className:"w-full rounded-none bg-slate-600 text-white",children:t("common.edit")})}),e.jsxs(y,{className:"modalContent","aria-describedby":void 0,children:[e.jsx(U,{children:e.jsx(E,{children:t("common.edit")+t("common.map")})}),e.jsxs(I,{onClick:r,className:"absolute z-50 right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(o,{asChild:!0,children:e.jsx(n,{variant:"outline",className:"grow shrink-0",type:"submit",onClick:b,children:t("mapUpload.saveAs")})}),j&&e.jsx(o,{asChild:!0,children:e.jsx(n,{variant:"outline",className:"grow shrink-0",type:"submit",onClick:C,children:t("common.upload")+t("common.map")})})]}),a.uuid&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:"地圖UUID:"}),e.jsx("p",{className:"text-xs",children:a.uuid})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:t("common.map")+t("common.name")}),e.jsx(T,{id:"mapName",defaultValue:a.name,onChange:s=>g(s.target.value),className:"w-full"})]}),e.jsxs(z,{className:"w-full flex flex-row flex-nowrap items-center",children:[e.jsx(o,{asChild:!0,children:e.jsx(n,{className:"w-[90px] shrink-0 mr-8 text-red-700 hover:text-red-500",variant:"ghost",size:"sm",onClick:v,children:t("common.delete")+t("common.map")})}),e.jsx(o,{asChild:!0,children:e.jsx(n,{className:"grow shrink-0",type:"submit",onClick:w,children:t("common.save")})})]})]})]})}export{L as default};
