import{r as g,b as w,j as e,J as y,h as j,c as b,f as v,i as z}from"./index-f433997a.js";import{A as R}from"./index.esm-a3c99c87.js";import{s as I,a as A,R as T,M as U,B as $}from"./ReadmeBtn-ca1c3df4.js";import{d as k}from"./index.esm-c108f41b.js";import{b as G,c as L,a as J}from"./index.esm-558cdf52.js";import{B as x}from"./button-c80087dc.js";import{D as C,a as p,b as S,c as D,d as F,e as E}from"./dialog-7aee5936.js";import{I as B}from"./input-938f7d21.js";import{b as O,e as P,i as _}from"./utils-2d860b5a.js";import{u as M}from"./jszip.min-25157898.js";import{u as N}from"./useDispatch-b8c750aa.js";import{G as q}from"./GoogleAds-d56f2437.js";function H({map:s}){const{t}=M(),[l,c]=g.useState(""),{mymaps:r,defaultMap:d}=w(a=>a.maps),o=async()=>{const a=await I(s);if(y.success("上傳完成"),a.isUpdate===!1){const u=a.data[0].value;n(j([...r,u]))}else{const u=r.map(f=>f.id===s.id?a.data[0].value:f);n(j(u))}},n=N(),m=()=>{const a={name:s.name,data:s.data,id:Date.now()};n(j([...r,a]))},h=()=>{const a=O(s);a.name=l;const u=r.map(f=>f.id===s.id?a:f);n(j(u))},i=()=>{const a=r.filter(u=>u.id!==s.id);n(j(a)),d.id===s.id&&n(b(a.length>0?a[0]:{}))};return e.jsxs(C,{children:[e.jsx(p,{asChild:!0,children:e.jsx(x,{className:"w-full rounded-none bg-slate-600 text-white",children:t("common.edit")})}),e.jsxs(S,{className:"modalContent",children:[e.jsx(D,{children:e.jsx(F,{children:t("common.edit")+t("common.map")})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(p,{asChild:!0,children:e.jsx(x,{variant:"outline",className:"grow shrink-0",type:"submit",onClick:m,children:"另存成新地圖"})}),!s.mid&&e.jsx(p,{asChild:!0,children:e.jsx(x,{variant:"outline",className:"grow shrink-0",type:"submit",onClick:o,children:"上傳地圖"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:t("common.map")+t("common.name")}),e.jsx(B,{id:"mapName",defaultValue:s.name,onChange:a=>c(a.target.value),className:"w-full"})]}),e.jsxs(E,{className:"w-full flex flex-row flex-nowrap items-center",children:[e.jsx(p,{asChild:!0,children:e.jsx(x,{className:"w-[90px] shrink-0 mr-8 text-red-700 hover:text-red-500",variant:"ghost",size:"sm",onClick:i,children:t("common.delete")+t("common.map")})}),e.jsx(p,{asChild:!0,children:e.jsx(x,{className:"grow shrink-0",type:"submit",onClick:h,children:t("common.save")})})]})]})]})}function V({map:s}){const{t}=M(),l=s.mid?`?mid=${s.mid}`:`?uuid=${s.uuid}`,c=window.location.href+l+"&name="+s.name,r=s.mid||s.uuid;async function d(n){try{await navigator.clipboard.writeText(n),alert(t("index.copyedMid",{mid:n}))}catch(m){console.error(m)}}const o=()=>{navigator.share?navigator.share({title:document.title,text:`${t("common.map")}${t("index.share")} - `+s.name,url:c}).then(()=>console.log("成功！")).catch(n=>console.log("發生錯誤",n)):console.log(c)};return e.jsx(e.Fragment,{children:e.jsxs(S,{className:"modalContent",children:[e.jsx(D,{children:e.jsx(F,{children:t("index.share")+t("common.map")})}),e.jsxs(e.Fragment,{children:[e.jsxs("h1",{className:"text-lg text-center",children:[e.jsx(k,{size:24,className:"inline-block mr-2",color:s.mid?"#5bb531":"#3E8EEF"}),s.name]}),e.jsxs("div",{className:"row",children:[e.jsxs("label",{className:"w-full block mb-2",htmlFor:"shareMid",children:[t("common.map")," id："]}),e.jsxs("div",{className:"inputGroup",children:[e.jsx(B,{className:"grow",name:"shareMid",type:"text",value:r,readOnly:!0}),e.jsx("div",{className:"shrink-0 ml-2 bg-slate-100 p-2 border border-slate-400",onClick:()=>d(s.mid||s.uuid),children:e.jsx(G,{size:"20",color:"#666"})})]})]})]}),e.jsx(E,{children:e.jsx(x,{type:"submit",onClick:o,children:t("index.share")})})]})})}function K({map:s}){const{t}=M();return e.jsxs(C,{children:[e.jsx(p,{asChild:!0,children:e.jsxs(x,{className:"w-full rounded-none text-white bg-green-600",children:[e.jsx(L,{className:"mr-2"}),t("index.share")]})}),e.jsx(V,{map:s})]})}function Q({item:s,afterSyncMap:t}){const{t:l}=M(),[c,r]=g.useState(s),[d,o]=g.useState(!1),n=v(),m=N(),h=a=>{localStorage.showedLayer="",m(b(a)),n("/")},i=async()=>{o(!0);try{let a;s.mid?a=await P(s.mid,s.name,s.id):a=(await A(s.uuid))[0].value,r(a),t(a),o(!1),y.success("地圖同步完成")}catch(a){console.log(a),o(!1)}};return e.jsxs("div",{className:"border border-gray-300 cursor-pointer flex flex-col justify-between relative","data-cy":"mapsBtns",children:[d&&e.jsxs("div",{"data-cy":"syncing",className:"z-10 absolute w-full h-full flex justify-center items-center bg-black/70 text-white",children:[l("index.sync"),"..."]}),(s.mid||s.uuid)&&e.jsx("div",{className:"absolute top-0 right-0 p-3",children:e.jsx(J,{size:24,color:s.mid?"#5bb531":"#FA825E",onClick:i,"data-cy":"syncMap"})}),e.jsxs("div",{className:"flex flex-col justify-center items-center my-4 px-4 grow",onClick:()=>h(c),children:[e.jsx(k,{size:44,color:s.mid?"#5bb531":"#3E8EEF"}),e.jsx("p",{className:"text-center mt-2",children:s.name})]},s.id),e.jsxs("div",{className:"flex",children:[e.jsx(H,{map:s}),(s.mid||s.uuid)&&e.jsx(K,{map:s})]})]})}function W(){const{t:s}=M(),[t]=z(),l=g.useRef(),c=t.get("mid"),r=t.get("uuid");g.useEffect(()=>{c&&l.current.click(),r&&l.current.click()},[c,r,l]);const{mymaps:d}=w(i=>i.maps),o=v(),n=N(),m=i=>{n(b(i))},h=()=>{const i=_();n(b(i)),o("/")};return e.jsxs("div",{className:"p-4",children:[d.length===0&&e.jsx(T,{}),e.jsx("button",{className:"w-full h-12 border-dashed border-2 text-gray-500",children:e.jsxs("div",{className:"flex justify-center relative","data-cy":"importMap",children:[e.jsx(U,{className:"absolute",type:"full",ref:l}),e.jsx($,{size:24}),e.jsx("p",{className:"ml-2",children:s("mapUpload.importMap")})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[d.map(i=>e.jsx(Q,{item:i,afterSyncMap:m},i.id)),e.jsxs("div",{onClick:h,className:"p-4 border border-gray-300 flex flex-col justify-center items-center cursor-pointer","data-cy":"add-blank-map",children:[e.jsx(R,{size:44,color:"#999"}),e.jsx("p",{className:"text-center mt-2 text-[#999]",children:s("index.addNewMap")})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(q,{})})]})}function oe(){return e.jsx("div",{className:"w-full h-full",children:e.jsx(W,{})})}export{oe as default};
