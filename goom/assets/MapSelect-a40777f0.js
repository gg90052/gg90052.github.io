import{i as S,r as h,j as e,b,g as y,c as f,d as j}from"./index-5dce310b.js";import{A as O}from"./index.esm-bb40a783.js";import{G as L,u}from"./jszip.min-8169156a.js";import{e as R,b as E,i as G}from"./utils-4e85e340.js";import{b as v,c as w,d as C,e as U,D as k,a as g}from"./dialog-2b3c4873.js";import{I as M}from"./input-9e2a8e5f.js";import{B as x}from"./index-f455567c.js";import{u as N}from"./useDispatch-822e393b.js";import{d as F}from"./index.esm-7c696d2b.js";import{a as T,b as V,c as A}from"./index.esm-aaf87f30.js";import{R as H}from"./ReadmeBtn-3edb7d89.js";import{G as P}from"./GoogleAds-50b7eb70.js";function z(a){return L({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"m12 18 4-5h-3V2h-2v11H8z"}},{tag:"path",attr:{d:"M19 9h-4v2h4v9H5v-9h4V9H5c-1.103 0-2 .897-2 2v9c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-9c0-1.103-.897-2-2-2z"}}]})(a)}function $({afterSave:a,setModalOpen:r}){const[o,d]=S(),[t,m]=h.useState(o.get("mid")||""),[n,p]=h.useState(o.get("name")||""),{t:c}=u(),s=h.useRef(),i=()=>{if(t===""){alert(c("mapUpload.emptyUrl"));return}else if((!t.includes("mid=")||!t.includes("google.com/maps/"))&&t.includes("https://")){m(""),alert(c("mapUpload.urlError"));return}const l=t.indexOf("mid=")>0?t.indexOf("mid=")+4:0,B=t.indexOf("&",l)>0?t.indexOf("&",l):t.length,I=t.substring(l,B);r(!1),a(I,n),d({})};return e.jsx(e.Fragment,{children:e.jsxs(v,{className:"modalContent","data-cy":"importMapModal",children:[e.jsx(w,{children:e.jsx(C,{children:c("mapUpload.importMap")})}),e.jsxs(e.Fragment,{children:[e.jsx("a",{className:"text-blue-500",href:"https://gg90052.github.io/blog/goom/",target:"_blank",rel:"noreferrer",children:c("mapUpload.howto")}),e.jsx(M,{type:"text",placeholder:c("mapUpload.emptyUrl"),defaultValue:t,onChange:l=>m(l.target.value),"data-cy":"mapURL"}),e.jsx(M,{type:"text",placeholder:c("mapUpload.enterName"),ref:s,defaultValue:n,onChange:l=>p(l.target.value),"data-cy":"mapName"})]}),e.jsx(U,{children:e.jsx(x,{type:"submit",onClick:i,"data-cy":"saveImportMap",children:c("mapUpload.importMap")})})]})})}const D=h.forwardRef(({type:a="import",size:r=24},o)=>{const[d,t]=h.useState(!1),{mymaps:m}=b(s=>s.maps),n=N(),p=y(),c=async(s,i)=>{const l=await R(s,i);n(f(l)),n(j([...m,l])),p("/")};return e.jsxs("div",{className:a==="full"?"w-full h-full absolute":"",children:[a==="import"&&e.jsx(z,{size:r,ref:o,onClick:()=>t(!0)}),a==="full"&&e.jsx("div",{className:"w-full h-full",ref:o,onClick:()=>t(!0)}),e.jsx(k,{open:d,onOpenChange:t,children:e.jsx($,{afterSave:(s,i)=>c(s,i),setModalOpen:t})})]})});D.displayName="MapUploader";function q({map:a}){const{t:r}=u(),[o,d]=h.useState(""),{mymaps:t,defaultMap:m}=b(s=>s.maps),n=N(),p=()=>{const s=E(a);s.name=o;const i=t.map(l=>l.id===a.id?s:l);n(j(i))},c=()=>{const s=t.filter(i=>i.id!==a.id);n(j(s)),m.id===a.id&&n(f(s.length>0?s[0]:{}))};return e.jsxs(k,{children:[e.jsx(g,{asChild:!0,children:e.jsx(x,{className:"w-full rounded-none bg-slate-600 text-white",children:r("common.edit")})}),e.jsxs(v,{className:"modalContent",children:[e.jsx(w,{children:e.jsx(C,{children:r("common.edit")+r("common.map")})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:r("common.map")+r("common.name")}),e.jsx(M,{id:"mapName",defaultValue:a.name,onChange:s=>d(s.target.value),className:"w-full"})]}),e.jsxs(U,{className:"w-full flex flex-row flex-nowrap items-center",children:[e.jsx(g,{asChild:!0,children:e.jsx(x,{className:"w-[90px] shrink-0 mr-8 text-red-700 hover:text-red-500",variant:"ghost",size:"sm",onClick:c,children:r("common.delete")+r("common.map")})}),e.jsx(g,{asChild:!0,children:e.jsx(x,{className:"grow shrink-0",type:"submit",onClick:p,children:r("common.save")})})]})]})]})}function _({map:a}){const{t:r}=u(),o=window.location.href+"?mid="+a.mid+"&name="+a.name,d=a.mid;async function t(n){try{await navigator.clipboard.writeText(n),alert(r("index.copyedMid",{mid:n}))}catch(p){console.error(p)}}const m=()=>{navigator.share?navigator.share({title:document.title,text:`${r("common.map")}${r("index.share")} - `+a.name,url:o}).then(()=>console.log("成功！")).catch(n=>console.log("發生錯誤",n)):console.log(o)};return e.jsx(e.Fragment,{children:e.jsxs(v,{className:"modalContent",children:[e.jsx(w,{children:e.jsx(C,{children:r("index.share")+r("common.map")})}),e.jsxs(e.Fragment,{children:[e.jsxs("h1",{className:"text-lg text-center",children:[e.jsx(F,{size:24,className:"inline-block mr-2",color:"#5bb531"}),a.name]}),e.jsxs("div",{className:"row",children:[e.jsxs("label",{className:"w-full block mb-2",htmlFor:"shareMid",children:[r("common.map")," Mid："]}),e.jsxs("div",{className:"inputGroup",children:[e.jsx(M,{className:"grow",name:"shareMid",type:"text",value:d,readOnly:!0}),e.jsx("div",{className:"shrink-0 ml-2 bg-slate-100 p-2 border border-slate-400",onClick:()=>t(a.mid),children:e.jsx(T,{size:"20",color:"#666"})})]})]})]}),e.jsx(U,{children:e.jsx(x,{type:"submit",onClick:m,children:r("index.share")})})]})})}function J({map:a}){const{t:r}=u();return e.jsxs(k,{children:[e.jsx(g,{asChild:!0,children:e.jsxs(x,{className:"w-full rounded-none bg-green-600 text-white",children:[e.jsx(V,{className:"mr-2"}),r("index.share")]})}),e.jsx(_,{map:a})]})}function K({item:a,afterSyncMap:r}){const{t:o}=u(),[d,t]=h.useState(a),[m,n]=h.useState(!1),p=y(),c=N(),s=l=>{localStorage.showedLayer="",c(f(l)),p("/")},i=async()=>{n(!0);try{const l=await R(a.mid,a.name,a.id);t(l),r(l),n(!1)}catch(l){console.log(l),n(!1)}};return e.jsxs("div",{className:"border border-gray-300 cursor-pointer flex flex-col justify-between relative","data-cy":"mapsBtns",children:[m&&e.jsxs("div",{"data-cy":"syncing",className:"z-10 absolute w-full h-full flex justify-center items-center bg-black/70 text-white",children:[o("index.sync"),"..."]}),a.mid&&e.jsx("div",{className:"absolute top-0 right-0 p-3",children:e.jsx(A,{size:24,color:"#5bb531",onClick:i,"data-cy":"syncMap"})}),e.jsxs("div",{className:"flex flex-col justify-center items-center my-4 px-4 grow",onClick:()=>s(d),children:[e.jsx(F,{size:44,color:"#5bb531"}),e.jsx("p",{className:"text-center mt-2",children:a.name})]},a.id),e.jsxs("div",{className:"flex",children:[e.jsx(q,{map:a}),a.mid&&e.jsx(J,{map:a})]})]})}function Q(){const{t:a}=u(),[r]=S(),o=h.useRef(),d=r.get("mid");h.useEffect(()=>{d&&o.current.click()},[d,o]);const{mymaps:t}=b(s=>s.maps),m=y(),n=N(),p=s=>{const i=t.map(l=>l.id===s.id?s:l);n(f(s)),n(j(i))},c=()=>{const s=G();n(f(s)),n(j([...t,s])),m("/")};return e.jsxs("div",{className:"p-4",children:[t.length===0&&e.jsx(H,{}),e.jsx("button",{className:"w-full h-12 border-dashed border-2 text-gray-500",children:e.jsxs("div",{className:"flex justify-center relative","data-cy":"importMap",children:[e.jsx(D,{className:"absolute",type:"full",ref:o}),e.jsx(z,{size:24}),e.jsx("p",{className:"ml-2",children:a("mapUpload.importMap")})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[t.map(s=>e.jsx(K,{item:s,afterSyncMap:p},s.id)),e.jsxs("div",{onClick:c,className:"p-4 border border-gray-300 flex flex-col justify-center items-center cursor-pointer","data-cy":"add-blank-map",children:[e.jsx(O,{size:44,color:"#999"}),e.jsx("p",{className:"text-center mt-2 text-[#999]",children:a("index.addNewMap")})]})]}),e.jsx(P,{})]})}function ce(){return e.jsx("div",{className:"w-full h-full",children:e.jsx(Q,{})})}export{ce as default};
