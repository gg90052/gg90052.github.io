import{r as m,b as g,j as e,d as x,c as h,f as N,h as b}from"./index-3d749199.js";import{A as M}from"./index.esm-4268e967.js";import{R as w,M as v,B as y}from"./ReadmeBtn-a60c44dc.js";import{d as S}from"./index.esm-0c034076.js";import{a as k,b as C}from"./index.esm-cd9b8d17.js";import{B as p}from"./index-e3f7be6b.js";import{D,a as u,b as B,c as z,d as F,e as E}from"./dialog-3debc61d.js";import{I}from"./input-3bad3d94.js";import{b as R,e as A,i as L}from"./utils-545a1a06.js";import{u as f}from"./useDispatch-84b11c72.js";import"./iconBase-7949b42f.js";import"./jszip.min-e8be587f.js";function P({map:s}){const[r,l]=m.useState(""),{mymaps:n,defaultMap:o}=g(a=>a.maps),i=f(),d=()=>{const a=R(s);a.name=r;const c=n.map(j=>j.id===s.id?a:j);i(x(c))},t=()=>{const a=n.filter(c=>c.id!==s.id);i(x(a)),o.id===s.id&&i(h(a.length>0?a[0]:{}))};return e.jsxs(D,{children:[e.jsx(u,{asChild:!0,children:e.jsx(p,{className:"w-full rounded-none bg-slate-600 text-white",children:"編輯"})}),e.jsxs(B,{className:"modalContent",children:[e.jsx(z,{children:e.jsx(F,{children:"編輯地圖"})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:"地圖名稱"}),e.jsx(I,{id:"mapName",defaultValue:s.name,onChange:a=>l(a.target.value),className:"w-full"})]}),e.jsxs(E,{className:"w-full flex flex-row flex-nowrap items-center",children:[e.jsx(u,{asChild:!0,children:e.jsx(p,{className:"w-[90px] shrink-0 mr-8 text-red-700 hover:text-red-500",variant:"ghost",size:"sm",onClick:t,children:"刪除地圖"})}),e.jsx(u,{asChild:!0,children:e.jsx(p,{className:"grow shrink-0",type:"submit",onClick:d,children:"儲存"})})]})]})]})}function T({map:s}){const r=()=>{navigator.share?navigator.share({title:document.title,text:"地圖分享 - "+s.name,url:window.location.href+s.mid+"&name="+s.name}).then(()=>console.log("成功！")).catch(l=>console.log("發生錯誤",l)):console.log("https://gg90052.github.io/goom/#/mapSelect?mid="+s.mid+"&name="+s.name)};return e.jsxs(p,{onClick:r,className:"w-full rounded-none bg-green-600 text-white",children:[e.jsx(k,{className:"mr-2"}),"分享"]})}function U({item:s}){const[r,l]=m.useState(s),[n,o]=m.useState(!1),i=N(),d=f(),t=c=>{localStorage.showedLayer="",d(h(c)),i("/")},a=async()=>{o(!0);const c=await A(s.mid,s.name,s.id);l(c),o(!1)};return e.jsxs("div",{className:"border border-gray-300 cursor-pointer flex flex-col justify-between relative",children:[n&&e.jsx("div",{className:"z-10 absolute w-full h-full flex justify-center items-center bg-black/70 text-white",children:"同步地圖中..."}),s.mid&&e.jsx("div",{className:"absolute top-0 right-0 p-3",children:e.jsx(C,{size:24,color:"#5bb531",onClick:a})}),e.jsxs("div",{className:"flex flex-col justify-center items-center my-4 px-4 grow",onClick:()=>t(r),children:[e.jsx(S,{size:44,color:"#5bb531"}),e.jsx("p",{className:"text-center mt-2",children:s.name})]},s.id),e.jsxs("div",{className:"flex",children:[e.jsx(P,{map:s}),s.mid&&e.jsx(T,{map:s})]})]})}function q(){const[s]=b(),r=m.useRef(),l=s.get("mid");m.useEffect(()=>{l&&r.current.click()},[l,r]);const{mymaps:n}=g(t=>t.maps),o=N(),i=f(),d=()=>{const t=L();i(h(t)),i(x([...n,t])),o("/")};return e.jsxs("div",{className:"p-4",children:[n.length===0&&e.jsx(w,{}),e.jsx("button",{className:"w-full h-12 border-dashed border-2 text-gray-500",children:e.jsxs("div",{className:"flex justify-center relative",children:[e.jsx(v,{className:"absolute",type:"full",ref:r}),e.jsx(y,{size:24}),e.jsx("p",{className:"ml-2",children:"匯入地圖"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[n.map(t=>e.jsx(U,{item:t},t.id)),e.jsxs("div",{onClick:d,className:"p-4 border border-gray-300 flex flex-col justify-center items-center cursor-pointer","data-cy":"add-blank-map",children:[e.jsx(M,{size:44,color:"#999"}),e.jsx("p",{className:"text-center mt-2 text-[#999]",children:"新增空白地圖"})]})]})]})}function $(){return e.jsx("div",{className:"w-full h-full",children:e.jsx(q,{})})}export{$ as default};
