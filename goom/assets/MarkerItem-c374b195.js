import{j as e,r as f,b as N,d as g,c as v,i as F}from"./index-e71b9f7b.js";import{F as S,c as C}from"./index.esm-19a98e33.js";import{M as D,a as y,b as E}from"./index.esm-07e3205d.js";import{f as I,s as z,b as L,d as G,g as T}from"./utils-b0711ac7.js";import{c as B,B as k}from"./index-757532e1.js";import{D as H,a as j,b as _,c as P,d as U,e as J}from"./dialog-1f698126.js";import{G as O}from"./iconBase-9b62959d.js";import{I as R}from"./input-211aa1d0.js";import{u as b}from"./useDispatch-620cdcd7.js";function V({description:s}){const i=I(s);return e.jsx("div",{className:"p-4 min-h-[30px] break-all border-b-2",children:e.jsx("p",{dangerouslySetInnerHTML:{__html:i}})})}function $({iconId:s,src:i,size:n=24}){const d=JSON.parse(localStorage.getItem("icons"))||{},c=s?d[z(s)]:i||"defaultMarker.png";return e.jsx("div",{className:`w-[${n}] aspect-auto overflow-hidden`,children:e.jsx("img",{className:"w-full",src:c,alt:""})})}function A(s){return O({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}},{tag:"path",attr:{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"}}]})(s)}const w=f.forwardRef(({className:s,...i},n)=>e.jsx("textarea",{className:B("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",s),ref:n,...i}));w.displayName="Textarea";function W({marker:s,layerId:i}){const[n,d]=f.useState(s.name),[c,u]=f.useState(s.description),{mymaps:m,defaultMap:p}=N(t=>t.maps),o=b(),l=L(p),x=()=>{l.data.forEach(a=>{a.id===i&&a.markers.forEach(r=>{r.id===s.id&&(r.name=n,r.description=c)})});const t=m.map(a=>a.id===p.id?l:a);o(g(t)),o(v(l))},h=()=>{l.data.forEach(a=>{a.markers=a.markers.filter(r=>r.id!==s.id)});const t=m.map(a=>a.id===p.id?l:a);o(g(t)),o(v(l))};return e.jsxs(H,{children:[e.jsx(j,{children:e.jsx(A,{size:24})}),e.jsxs(_,{className:"modalContent moreUp",children:[e.jsx(P,{children:e.jsx(U,{children:"編輯標記"})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:"地點名稱"}),e.jsx(R,{defaultValue:n,onChange:t=>d(t.target.value),className:"w-full mb-4"}),e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:"地點備註"}),e.jsx(w,{defaultValue:c,onChange:t=>u(t.target.value),className:"w-full h-24"})]}),e.jsxs(J,{className:"w-full flex flex-row flex-nowrap items-center",children:[e.jsx(j,{asChild:!0,children:e.jsx(k,{className:"w-[90px] shrink-0 mr-8 text-red-700 hover:text-red-500",variant:"ghost",size:"sm",onClick:h,children:"刪除標記"})}),e.jsx(j,{asChild:!0,children:e.jsx(k,{className:"grow shrink-0",type:"submit",onClick:x,children:"儲存"})})]})]})]})}function re({item:s,layerId:i,readonly:n=!1}){const[d,c]=f.useState(!1),u=G(s),m=T(s),p=b(),{favorites:o,isEditMode:l}=N(a=>a.maps),x=o.find(a=>a.id===s.id),h=a=>{c(r=>!r)},t=a=>{a.stopPropagation();let r="";x?r=o.filter(M=>M.id!==s.id):r=[...o,s],p(F(r)),localStorage.setItem("favorites",JSON.stringify(r))};return e.jsxs("li",{className:"list-none",children:[e.jsxs("div",{className:"min-h-[3rem] flex justify-between items-center px-2 py-2 border-b",children:[e.jsx("div",{className:"w-6 h-6 shrink-0 mr-2",onClick:t,children:x?e.jsx(D,{size:24,fill:"#f00"}):e.jsx(y,{size:24,fill:"#f00"})}),e.jsx("div",{className:"w-6 h-6 shrink-0 mr-2",children:e.jsx($,{iconId:s.icon})}),e.jsxs("p",{className:"text-md mr-4 grow",onClick:h,children:[s.name,s.description&&e.jsx(E,{className:`inline-block transition-transform ${d?"":"-rotate-90"}`,size:24})]}),e.jsx("div",{className:"flex shrink-0 justify-end mr-2 space-x-3",children:!n&&l?e.jsx(W,{marker:s,layerId:i}):e.jsxs(e.Fragment,{children:[e.jsx("a",{href:u,className:"ml-2",target:"_blank",rel:"noreferrer",children:e.jsx(S,{size:24,fill:"#666"})}),e.jsx("a",{href:m,className:"ml-2",target:"_blank",rel:"noreferrer",children:e.jsx(C,{size:24,fill:"#666"})})]})})]}),s.description&&d&&e.jsx(V,{description:s.description})]})}export{A as F,re as M};
