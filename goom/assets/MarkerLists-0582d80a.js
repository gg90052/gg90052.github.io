import{r as j,b as L,j as e,d as N,c as k,e as S,f as v,g as M}from"./index-83711429.js";import{F as b,M as E}from"./MarkerItem-7f69dd34.js";import{b as z,c as B,d as H,e as R}from"./index.esm-caf470fa.js";import{s as T}from"./MarkerLayer.module-d174b900.js";import{B as F}from"./index-c4919f9c.js";import{D as A,a as w,b as O,c as $,d as J,e as P}from"./dialog-89bcc8fe.js";import{I as U}from"./input-e3b4232a.js";import{u as y}from"./useLocalStorageState-8af17beb.js";import{b as C,c as V}from"./utils-12d3311a.js";import{u as D}from"./useDispatch-453bc9af.js";import{M as q,R as G}from"./ReadmeBtn-ad55476f.js";import"./index.esm-8c0ae10e.js";import"./iconBase-f462483c.js";import"./index.esm-94174c63.js";import"./index.esm-9e3bdab0.js";function I({layerName:s,layerId:a}){const[u,l]=j.useState(""),{mymaps:o,defaultMap:r}=L(i=>i.maps),[d,x]=y("-1","defaultLayer"),[h,n]=y([],"showedLayer"),m=D(),t=C(r),c=()=>{const i=t.data.find(g=>g.id===a);i.name=u;const p=o.map(g=>g.id===r.id?t:g);m(N(p)),m(k(t))},f=()=>{t.data=t.data.filter(p=>p.id!==a);const i=o.map(p=>p.id===r.id?t:p);m(N(i)),m(k(t)),a===d&&x("-1"),h.includes(a)&&n(h.filter(p=>p!==a))};return e.jsxs(A,{children:[e.jsx(w,{children:e.jsx(b,{size:24})}),e.jsxs(O,{className:"modalContent",children:[e.jsx($,{children:e.jsx(J,{children:"編輯圖層"})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:"圖層名稱"}),e.jsx(U,{id:"layerName",defaultValue:s,onChange:i=>l(i.target.value),className:"w-full"})]}),e.jsxs(P,{className:"w-full flex flex-row flex-nowrap items-center",children:[e.jsx(w,{asChild:!0,children:e.jsx(F,{className:"w-[90px] shrink-0 mr-8 text-red-700 hover:text-red-500",variant:"ghost",size:"sm",onClick:f,children:"刪除圖層"})}),e.jsx(w,{asChild:!0,children:e.jsx(F,{className:"grow shrink-0",type:"submit",onClick:c,children:"儲存"})})]})]})]})}function K({layerId:s,name:a,children:u}){var t;const{isEditMode:l,defaultMap:o}=L(c=>c.maps),[r,d]=y([],"showedLayer"),[x,h]=j.useState(r.includes(s)),n=((t=o.data.find(c=>c.id===s))==null?void 0:t.markers.length)||0,m=c=>{h(i=>!i);const f=JSON.parse(localStorage.getItem("showedLayer"));f.includes(s)?d(f.filter(i=>i!==s)):d([...f,s])};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:T.layer,children:[x===!0?e.jsx(z,{size:24,fill:"#73D0FA"}):e.jsx(B,{size:24,fill:"#73D0FA"}),e.jsx("p",{className:"grow",onClick:m,children:`${a} (${n})`}),l&&e.jsx(I,{layerId:s,layerName:a})]}),x===!0&&e.jsx("ul",{children:u})]})}function Q({name:s,addLayer:a=!0}){const{mymaps:u,defaultMap:l,isEditMode:o}=L(t=>t.maps),[r,d]=y("-1","defaultLayer"),{pathname:x}=S(),h=v(),n=D();j.useEffect(()=>{n(M(!1))},[x,n]);const m=()=>{const t=C(l),c=V();t.data=[...t.data,c];const f=u.filter(i=>i.id!==l.id);n(N([...f,t])),n(k(t)),r==="-1"&&d(c.id)};return e.jsx("header",{className:"h-14 flex px-4 items-center gap-4 justify-between bg-slate-100 fixed top-0 left-0 w-full z-40",children:a?e.jsxs(e.Fragment,{children:[e.jsxs(F,{variant:"outline",onClick:()=>h("/mapSelect"),children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),s]}),e.jsx("div",{className:"flex",children:o?e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(q,{}),e.jsx(R,{onClick:m,size:24,fill:"#F1D272"}),e.jsx("p",{className:"text-blue-500",onClick:()=>n(M(!1)),children:"完成"})]}):e.jsx("p",{className:"text-blue-500",onClick:()=>n(M(!0)),children:"編輯"})})]}):e.jsx("p",{children:s})})}function ce(){var o;const{defaultMap:s}=L(r=>r.maps),[a,u]=j.useState(s),l=v();return j.useEffect(()=>{u(s)},[s]),j.useEffect(()=>{s.data||l("/mapSelect")},[s,l]),e.jsxs(e.Fragment,{children:[e.jsx(Q,{name:a.name}),((o=a==null?void 0:a.data)==null?void 0:o.length)>0?e.jsx(e.Fragment,{children:e.jsx("div",{style:{height:"100%",overflow:"auto",paddingTop:"3.5rem",paddingBottom:"4.5rem"},children:a.data&&a.data.map(r=>e.jsx(K,{name:r.name,layerId:r.id,mapId:a.id,children:r.markers.length>0&&r.markers.map(d=>e.jsx(E,{item:d,layerId:r.id},d.id))},r.id))})}):e.jsx("div",{className:"p-4 pt-16",children:e.jsx(G,{})})]})}export{ce as default};
