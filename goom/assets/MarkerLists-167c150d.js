import{r as y,b as w,j as e,d as N,c as v,e as H,f as R,g as S,h as b}from"./index-65759b21.js";import{F as A,M as $}from"./MarkerItem-44b6abe0.js";import{b as J,c as P,d as V,e as q}from"./index.esm-e39bb376.js";import{B as k}from"./index-a2f473cd.js";import{D as E,a as M,b as I,c as z,d as T,e as O}from"./dialog-655b461d.js";import{I as G}from"./input-25edf2d0.js";import{u as D}from"./useLocalStorageState-4787f195.js";import{b as B,c as K}from"./utils-1a6370a4.js";import{u as F}from"./jszip.min-d3ccbec5.js";import{u as C}from"./useDispatch-6b74ba8e.js";import{M as Q}from"./index.esm-671efe81.js";import{R as U}from"./ReadmeBtn-a69cbf1a.js";import"./index.esm-c33b3cad.js";import"./index.esm-296e09dc.js";import"./Icon-889d1a3c.js";import"./index.esm-38b32378.js";function W({layerName:d,layerId:t,className:u}){const{t:s}=F(),[p,n]=y.useState(""),{mymaps:c,defaultMap:m}=w(o=>o.maps),[f,j]=D("-1","defaultLayer"),[r,l]=D([],"showedLayer"),i=C(),a=B(m),h=()=>{const o=a.data.find(L=>L.id===t);o.name=p;const x=c.map(L=>L.id===m.id?a:L);i(N(x)),i(v(a))},g=()=>{a.data=a.data.filter(x=>x.id!==t);const o=c.map(x=>x.id===m.id?a:x);i(N(o)),i(v(a)),t===f&&j("-1"),r.includes(t)&&l(r.filter(x=>x!==t))};return e.jsxs(E,{children:[e.jsx(M,{children:e.jsx("div",{className:"w-6 h-6",children:e.jsx(A,{size:24,"data-cy":"triggerEditLayerModal",className:u})})}),e.jsxs(I,{className:"modalContent","data-cy":"editLayerModal",children:[e.jsx(z,{children:e.jsx(T,{children:s("common.edit")+s("common.layer")})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:s("common.layer")+s("common.name")}),e.jsx(G,{id:"layerName","data-cy":"layerNameInput",defaultValue:d,onChange:o=>n(o.target.value),className:"w-full"})]}),e.jsxs(O,{className:"w-full flex flex-row flex-nowrap items-center",children:[e.jsx(M,{asChild:!0,children:e.jsx(k,{className:"w-[90px] shrink-0 mr-8 text-red-700 hover:text-red-500",variant:"ghost","data-cy":"deleteLayer",size:"sm",onClick:g,children:s("common.delete")+s("common.layer")})}),e.jsx(M,{asChild:!0,children:e.jsx(k,{className:"grow shrink-0","data-cy":"saveLayer",type:"submit",onClick:h,children:s("common.save")})})]})]})]})}function X({layerId:d,name:t,children:u}){var l;const{isEditMode:s,defaultMap:p}=w(i=>i.maps),[n,c]=D([],"showedLayer"),[m,f]=y.useState(n.includes(d)),j=((l=p.data.find(i=>i.id===d))==null?void 0:l.markers.length)||0,r=i=>{f(h=>!h);const a=JSON.parse(localStorage.getItem("showedLayer"));a.includes(d)?c(a.filter(h=>h!==d)):c([...a,d])};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"markerLayer","data-cy":"layer-comp",children:[m===!0?e.jsx(J,{size:24,fill:"#73D0FA"}):e.jsx(P,{size:24,fill:"#73D0FA"}),e.jsx("p",{className:"grow",onClick:r,children:`${t} (${j})`}),e.jsx("div",{className:"w-6 h-6",children:e.jsx(W,{className:s?"slideIn":"slideOutRight",layerId:d,layerName:t})})]}),m===!0&&e.jsx("ul",{children:u})]})}function Y({className:d}){const{t}=F(),{selectedMarkerItem:u,defaultMap:s,mymaps:p}=w(r=>r.maps),[n,c]=y.useState(s.data?s.data[0].id:"-1"),m=C(),f=()=>{const r=j();m(H([]));const l=p.map(i=>i.id===r.id?r:i);m(N(l)),m(v(r))},j=()=>{let r=[];const l=s.data.map(a=>{const h=a.markers.filter(g=>{const o=u.includes(g.id);return o&&r.push(g),!o});return{...a,markers:h}}),i=l.findIndex(a=>a.id===n);if(i>-1){const a=l[i];l[i]={...a,markers:[...a.markers,...r]}}return{...s,data:l}};return e.jsxs(E,{children:[e.jsx(M,{children:e.jsx(Q,{size:24,fill:"#F1D272",className:d})}),e.jsxs(I,{className:"modalContent","data-cy":"editLayerModal",children:[e.jsx(z,{children:e.jsxs(T,{children:[t("index.moveMarker"),"..."]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:t("index.selectLayer")}),e.jsx("select",{className:"w-full h-10 border border-gray-300 rounded-md px-2",value:n,onChange:r=>c(r.target.value),children:s.data&&s.data.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))})]}),e.jsx(O,{className:"w-full flex flex-row flex-nowrap items-center",children:e.jsx(M,{asChild:!0,children:e.jsx(k,{className:"grow shrink-0","data-cy":"saveLayer",type:"submit",onClick:f,children:t("index.move")})})})]})]})}function Z({name:d,addLayer:t=!0}){const{t:u}=F(),{mymaps:s,defaultMap:p,isEditMode:n,selectedMarkerItem:c}=w(a=>a.maps),[m,f]=D("-1","defaultLayer"),{pathname:j}=R(),r=S(),l=C();y.useEffect(()=>{l(b(!1))},[j,l]);const i=()=>{const a=B(p),h=K();a.data=[...a.data,h];const g=s.map(o=>o.id===a.id?a:o);l(N(g)),l(v(a)),m==="-1"&&f(h.id)};return e.jsx("header",{className:"h-14 flex px-4 items-center gap-4 justify-between bg-slate-100 fixed top-0 left-0 w-full z-40",children:t?e.jsxs(e.Fragment,{children:[e.jsxs(k,{"data-cy":"map-name",variant:"outline",onClick:()=>r("/mapSelect"),children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),d]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Y,{className:n&&c.length>0?"fadeIn":"fadeOut"}),e.jsx(q,{"data-cy":"add-layer",className:n?"fadeIn":"fadeOut",onClick:i,size:24,fill:"#F1D272"}),e.jsx("p",{"data-cy":"trigger-edit-mode",className:"text-blue-500 whitespace-nowrap",onClick:()=>l(b(!n)),children:u(n?"common.finish":"common.edit")})]})]}):e.jsx("p",{children:d})})}function xe(){var p;const{defaultMap:d}=w(n=>n.maps),[t,u]=y.useState(d),s=S();return y.useEffect(()=>{u(d)},[d]),y.useEffect(()=>{d.data||s("/mapSelect")},[d,s]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{name:t.name}),((p=t==null?void 0:t.data)==null?void 0:p.length)>0?e.jsx(e.Fragment,{children:e.jsx("div",{style:{height:"100%",overflow:"auto",paddingTop:"3.5rem",paddingBottom:"4.5rem"},children:t.data&&t.data.map(n=>e.jsx(X,{name:n.name,layerId:n.id,mapId:t.id,children:n.markers.length>0&&n.markers.map(c=>e.jsx($,{item:c,layerId:n.id},c.id))},n.id))})}):e.jsx("div",{className:"p-4 pt-16",children:e.jsx(U,{})})]})}export{xe as default};
