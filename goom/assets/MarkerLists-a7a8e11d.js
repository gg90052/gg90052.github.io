import{r as y,b as L,j as e,d as k,c as N,e as H,f as R,g as S,h as b}from"./index-39f272bc.js";import{F as A,M as $}from"./MarkerItem-a4952b08.js";import{b as J,c as P,d as V,e as q}from"./index.esm-b68a7b18.js";import{B as v}from"./index-a3ebf8f6.js";import{D as E,a as M,b as I,c as z,d as T,e as O}from"./dialog-8968a5a2.js";import{I as G}from"./input-5b659442.js";import{u as D}from"./useLocalStorageState-1baa7385.js";import{b as B,c as K}from"./utils-81600d0f.js";import{u as F}from"./jszip.min-0cdc25e6.js";import{u as C}from"./useDispatch-e6fe4a6e.js";import{M as Q}from"./index.esm-c8e41c56.js";import{R as U}from"./ReadmeBtn-f3a7409d.js";import"./index.esm-2239ff26.js";import"./index.esm-e8eb3cb1.js";import"./Icon-9f2d27ef.js";import"./index.esm-97a2d17c.js";function W({layerName:d,layerId:t,className:p}){const{t:s}=F(),[u,n]=y.useState(""),{mymaps:l,defaultMap:c}=L(m=>m.maps),[h,j]=D("-1","defaultLayer"),[r,o]=D([],"showedLayer"),i=C(),a=B(c),x=()=>{const m=a.data.find(w=>w.id===t);m.name=u;const f=l.map(w=>w.id===c.id?a:w);i(k(f)),i(N(a))},g=()=>{a.data=a.data.filter(f=>f.id!==t);const m=l.map(f=>f.id===c.id?a:f);i(k(m)),i(N(a)),t===h&&j("-1"),r.includes(t)&&o(r.filter(f=>f!==t))};return e.jsxs(E,{children:[e.jsx(M,{children:e.jsx(A,{size:24,"data-cy":"triggerEditLayerModal",className:p})}),e.jsxs(I,{className:"modalContent","data-cy":"editLayerModal",children:[e.jsx(z,{children:e.jsx(T,{children:s("common.edit")+s("common.layer")})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:s("common.layer")+s("common.name")}),e.jsx(G,{id:"layerName","data-cy":"layerNameInput",defaultValue:d,onChange:m=>n(m.target.value),className:"w-full"})]}),e.jsxs(O,{className:"w-full flex flex-row flex-nowrap items-center",children:[e.jsx(M,{asChild:!0,children:e.jsx(v,{className:"w-[90px] shrink-0 mr-8 text-red-700 hover:text-red-500",variant:"ghost","data-cy":"deleteLayer",size:"sm",onClick:g,children:s("common.delete")+s("common.layer")})}),e.jsx(M,{asChild:!0,children:e.jsx(v,{className:"grow shrink-0","data-cy":"saveLayer",type:"submit",onClick:x,children:s("common.save")})})]})]})]})}function X({layerId:d,name:t,children:p}){var o;const{isEditMode:s,defaultMap:u}=L(i=>i.maps),[n,l]=D([],"showedLayer"),[c,h]=y.useState(n.includes(d)),j=((o=u.data.find(i=>i.id===d))==null?void 0:o.markers.length)||0,r=i=>{h(x=>!x);const a=JSON.parse(localStorage.getItem("showedLayer"));a.includes(d)?l(a.filter(x=>x!==d)):l([...a,d])};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"markerLayer","data-cy":"layer-comp",children:[c===!0?e.jsx(J,{size:24,fill:"#73D0FA"}):e.jsx(P,{size:24,fill:"#73D0FA"}),e.jsx("p",{className:"grow",onClick:r,children:`${t} (${j})`}),e.jsx(W,{className:s?"slideIn":"slideOutRight static",layerId:d,layerName:t})]}),c===!0&&e.jsx("ul",{children:p})]})}function Y({className:d}){const{t}=F(),{selectedMarkerItem:p,defaultMap:s,mymaps:u}=L(r=>r.maps),[n,l]=y.useState(s.data?s.data[0].id:"-1"),c=C(),h=()=>{const r=j();c(H([]));const o=u.map(i=>i.id===r.id?r:i);c(k(o)),c(N(r))},j=()=>{let r=[];const o=s.data.map(a=>{const x=a.markers.filter(g=>{const m=p.includes(g.id);return m&&r.push(g),!m});return{...a,markers:x}}),i=o.findIndex(a=>a.id===n);if(i>-1){const a=o[i];o[i]={...a,markers:[...a.markers,...r]}}return{...s,data:o}};return e.jsxs(E,{children:[e.jsx(M,{children:e.jsx(Q,{size:24,fill:"#F1D272",className:d})}),e.jsxs(I,{className:"modalContent","data-cy":"editLayerModal",children:[e.jsx(z,{children:e.jsxs(T,{children:[t("index.moveMarker"),"..."]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:t("index.selectLayer")}),e.jsx("select",{className:"w-full h-10 border border-gray-300 rounded-md px-2",value:n,onChange:r=>l(r.target.value),children:s.data&&s.data.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))})]}),e.jsx(O,{className:"w-full flex flex-row flex-nowrap items-center",children:e.jsx(M,{asChild:!0,children:e.jsx(v,{className:"grow shrink-0","data-cy":"saveLayer",type:"submit",onClick:h,children:t("index.move")})})})]})]})}function Z({name:d,addLayer:t=!0}){const{t:p}=F(),{mymaps:s,defaultMap:u,isEditMode:n,selectedMarkerItem:l}=L(a=>a.maps),[c,h]=D("-1","defaultLayer"),{pathname:j}=R(),r=S(),o=C();y.useEffect(()=>{o(b(!1))},[j,o]);const i=()=>{const a=B(u),x=K();a.data=[...a.data,x];const g=s.filter(m=>m.id!==u.id);o(k([...g,a])),o(N(a)),c==="-1"&&h(x.id)};return e.jsx("header",{className:"h-14 flex px-4 items-center gap-4 justify-between bg-slate-100 fixed top-0 left-0 w-full z-40",children:t?e.jsxs(e.Fragment,{children:[e.jsxs(v,{"data-cy":"map-name",variant:"outline",onClick:()=>r("/mapSelect"),children:[e.jsx(V,{className:"mr-2 h-4 w-4"}),d]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(Y,{className:n&&l.length>0?"fadeIn":"fadeOut"}),e.jsx(q,{"data-cy":"add-layer",className:n?"fadeIn":"fadeOut",onClick:i,size:24,fill:"#F1D272"}),e.jsx("p",{"data-cy":"trigger-edit-mode",className:"text-blue-500",onClick:()=>o(b(!n)),children:p(n?"common.finish":"common.edit")})]})]}):e.jsx("p",{children:d})})}function fe(){var u;const{defaultMap:d}=L(n=>n.maps),[t,p]=y.useState(d),s=S();return y.useEffect(()=>{p(d)},[d]),y.useEffect(()=>{d.data||s("/mapSelect")},[d,s]),e.jsxs(e.Fragment,{children:[e.jsx(Z,{name:t.name}),((u=t==null?void 0:t.data)==null?void 0:u.length)>0?e.jsx(e.Fragment,{children:e.jsx("div",{style:{height:"100%",overflow:"auto",paddingTop:"3.5rem",paddingBottom:"4.5rem"},children:t.data&&t.data.map(n=>e.jsx(X,{name:n.name,layerId:n.id,mapId:t.id,children:n.markers.length>0&&n.markers.map(l=>e.jsx($,{item:l,layerId:n.id},l.id))},n.id))})}):e.jsx("div",{className:"p-4 pt-16",children:e.jsx(U,{})})]})}export{fe as default};
