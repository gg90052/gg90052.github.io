import{r as j,b as L,j as e,d as N,c as k,e as S,f as v,g as M}from"./index-3d749199.js";import{F as b,M as E}from"./MarkerItem-c6aa3631.js";import{b as z,c as B,d as H,e as R}from"./index.esm-0c034076.js";import{s as T}from"./MarkerLayer.module-d174b900.js";import{B as F}from"./index-e3f7be6b.js";import{D as A,a as w,b as O,c as $,d as J,e as P}from"./dialog-3debc61d.js";import{I as U}from"./input-3bad3d94.js";import{u as y}from"./useLocalStorageState-947b90d7.js";import{b as C,c as V}from"./utils-545a1a06.js";import{u as D}from"./useDispatch-84b11c72.js";import{M as q,R as G}from"./ReadmeBtn-a60c44dc.js";import"./index.esm-cd9b8d17.js";import"./iconBase-7949b42f.js";import"./index.esm-bdcca742.js";import"./jszip.min-e8be587f.js";import"./index.esm-4268e967.js";function I({layerName:s,layerId:a}){const[u,d]=j.useState(""),{mymaps:l,defaultMap:r}=L(i=>i.maps),[o,x]=y("-1","defaultLayer"),[h,n]=y([],"showedLayer"),m=D(),t=C(r),c=()=>{const i=t.data.find(g=>g.id===a);i.name=u;const p=l.map(g=>g.id===r.id?t:g);m(N(p)),m(k(t))},f=()=>{t.data=t.data.filter(p=>p.id!==a);const i=l.map(p=>p.id===r.id?t:p);m(N(i)),m(k(t)),a===o&&x("-1"),h.includes(a)&&n(h.filter(p=>p!==a))};return e.jsxs(A,{children:[e.jsx(w,{children:e.jsx(b,{size:24})}),e.jsxs(O,{className:"modalContent",children:[e.jsx($,{children:e.jsx(J,{children:"編輯圖層"})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:"圖層名稱"}),e.jsx(U,{id:"layerName",defaultValue:s,onChange:i=>d(i.target.value),className:"w-full"})]}),e.jsxs(P,{className:"w-full flex flex-row flex-nowrap items-center",children:[e.jsx(w,{asChild:!0,children:e.jsx(F,{className:"w-[90px] shrink-0 mr-8 text-red-700 hover:text-red-500",variant:"ghost",size:"sm",onClick:f,children:"刪除圖層"})}),e.jsx(w,{asChild:!0,children:e.jsx(F,{className:"grow shrink-0",type:"submit",onClick:c,children:"儲存"})})]})]})]})}function K({layerId:s,name:a,children:u}){var t;const{isEditMode:d,defaultMap:l}=L(c=>c.maps),[r,o]=y([],"showedLayer"),[x,h]=j.useState(r.includes(s)),n=((t=l.data.find(c=>c.id===s))==null?void 0:t.markers.length)||0,m=c=>{h(i=>!i);const f=JSON.parse(localStorage.getItem("showedLayer"));f.includes(s)?o(f.filter(i=>i!==s)):o([...f,s])};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:T.layer,"data-cy":"layer-comp",children:[x===!0?e.jsx(z,{size:24,fill:"#73D0FA"}):e.jsx(B,{size:24,fill:"#73D0FA"}),e.jsx("p",{className:"grow",onClick:m,children:`${a} (${n})`}),d&&e.jsx(I,{layerId:s,layerName:a})]}),x===!0&&e.jsx("ul",{children:u})]})}function Q({name:s,addLayer:a=!0}){const{mymaps:u,defaultMap:d,isEditMode:l}=L(t=>t.maps),[r,o]=y("-1","defaultLayer"),{pathname:x}=S(),h=v(),n=D();j.useEffect(()=>{n(M(!1))},[x,n]);const m=()=>{const t=C(d),c=V();t.data=[...t.data,c];const f=u.filter(i=>i.id!==d.id);n(N([...f,t])),n(k(t)),r==="-1"&&o(c.id)};return e.jsx("header",{className:"h-14 flex px-4 items-center gap-4 justify-between bg-slate-100 fixed top-0 left-0 w-full z-40",children:a?e.jsxs(e.Fragment,{children:[e.jsxs(F,{"data-cy":"map-name",variant:"outline",onClick:()=>h("/mapSelect"),children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),s]}),e.jsx("div",{className:"flex",children:l?e.jsxs("div",{"data-cy":"leave-edit-mode",className:"flex items-center space-x-4",children:[e.jsx(q,{}),e.jsx(R,{"data-cy":"add-layer",onClick:m,size:24,fill:"#F1D272"}),e.jsx("p",{className:"text-blue-500",onClick:()=>n(M(!1)),children:"完成"})]}):e.jsx("p",{"data-cy":"enter-edit-mode",className:"text-blue-500",onClick:()=>n(M(!0)),children:"編輯"})})]}):e.jsx("p",{children:s})})}function me(){var l;const{defaultMap:s}=L(r=>r.maps),[a,u]=j.useState(s),d=v();return j.useEffect(()=>{u(s)},[s]),j.useEffect(()=>{s.data||d("/mapSelect")},[s,d]),e.jsxs(e.Fragment,{children:[e.jsx(Q,{name:a.name}),((l=a==null?void 0:a.data)==null?void 0:l.length)>0?e.jsx(e.Fragment,{children:e.jsx("div",{style:{height:"100%",overflow:"auto",paddingTop:"3.5rem",paddingBottom:"4.5rem"},children:a.data&&a.data.map(r=>e.jsx(K,{name:r.name,layerId:r.id,mapId:a.id,children:r.markers.length>0&&r.markers.map(o=>e.jsx(E,{item:o,layerId:r.id},o.id))},r.id))})}):e.jsx("div",{className:"p-4 pt-16",children:e.jsx(G,{})})]})}export{me as default};
