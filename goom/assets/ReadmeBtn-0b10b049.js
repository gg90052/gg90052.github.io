import{r as p,b as v,j as e,d as h,c as N,e as M}from"./index-00c79337.js";import{b as F,h as z,s as B}from"./utils-0ebd077e.js";import{G as J}from"./iconBase-d2a8e1ba.js";import{b as y,c as k,d as w,e as I,D as j}from"./dialog-790e4c9a.js";import{B as S}from"./index-993b63cf.js";import{u as b}from"./useDispatch-dbf9f6b6.js";import{I as R}from"./input-5d7ee3d7.js";import{a as H}from"./index.esm-701bfae2.js";function T(a){return J({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"m12 18 4-5h-3V2h-2v11H8z"}},{tag:"path",attr:{d:"M19 9h-4v2h4v9H5v-9h4V9H5c-1.103 0-2 .897-2 2v9c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-9c0-1.103-.897-2-2-2z"}}]})(a)}function V({setModalOpen:a,afterSave:m}){const[t,d]=p.useState("-1"),{mymaps:o,defaultMap:l}=v(s=>s.maps),c=b(),u=()=>{const s=l.data?l:JSON.parse(localStorage.getItem("tempNewMap")),n=F(s),f=JSON.parse(localStorage.getItem("tempLayer"));if(t==="-1")n.data=[...n.data,...f];else{const i=n.data.findIndex(r=>r.id===t);n.data[i].markers=[...n.data[i].markers,...f[0].markers]}if(o.length===0)c(h([n]));else{const i=o.map(r=>r.id===l.id?n:r);c(h(i))}c(N(n)),localStorage.removeItem("tempLayer"),localStorage.removeItem("tempNewMap"),a(!1),m&&m(t)};return e.jsx(e.Fragment,{children:e.jsxs(y,{className:"modalContent",children:[e.jsx(k,{children:e.jsx(w,{children:"匯入 / 新建圖層"})}),e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:"選擇匯入圖層"}),e.jsxs("select",{className:"w-full h-10 border border-gray-300 rounded-md px-2",value:t,onChange:s=>d(s.target.value),children:[e.jsx("option",{value:"-1",children:"建立新圖層"}),l.data&&l.data.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsx(I,{children:e.jsx(S,{type:"submit",onClick:u,children:"確定"})})]})})}function E({afterSave:a,setModalOpen:m}){const[t,d]=p.useState(""),o=()=>{const l={id:Date.now(),name:t,data:[]};localStorage.setItem("tempNewMap",JSON.stringify(l)),m(!1),a&&a()};return e.jsx(e.Fragment,{children:e.jsxs(y,{className:"modalContent",children:[e.jsx(k,{children:e.jsx(w,{children:"設定地圖名稱"})}),e.jsx(e.Fragment,{children:e.jsx(R,{type:"text",defaultValue:t,onChange:l=>d(l.target.value)})}),e.jsx(I,{children:e.jsx(S,{type:"submit",onClick:o,children:"建立新地圖"})})]})})}function X({type:a="import",size:m=24}){const t=p.useRef(null),[d,o]=p.useState(!1),[l,c]=p.useState(!1),{mymaps:u}=v(i=>i.maps),s=b(),n=M(),f=async i=>{var r=i.target.files[0];if(r){if((r.type.includes(".kml")?"kml":"kmz")!=="kml"){const C=r.name.replace(".kmz","").replace(".kml",""),[{kmlJson:x,styleInKMZ:O,isMap:D},...L]=await z(r);if(B(O,L),D){const g={id:Date.now(),name:C,data:x};s(N(g)),s(h([...u,g])),n("/")}else localStorage.setItem("tempLayer",JSON.stringify(x)),u.length===0?o(!0):c(!0)}t.current.value=""}};return e.jsxs("div",{className:a==="full"?"w-full h-full absolute":"",children:[a==="import"&&e.jsx(T,{size:m,onClick:()=>t.current.click()}),a==="full"&&e.jsx("div",{className:"w-full h-full",onClick:()=>t.current.click()}),e.jsx("input",{type:"file",ref:t,onChange:f,id:"fileInput",accept:".kmz",className:a==="default"?"":"hidden"}),e.jsx(j,{open:d,onOpenChange:o,children:e.jsx(E,{afterSave:()=>c(!0),setModalOpen:o})}),e.jsx(j,{open:l,onOpenChange:c,children:e.jsx(V,{setModalOpen:c})})]})}function Y(){const a=M();return e.jsx("button",{className:"w-full h-12 border-2 border-blue-500 text-blue-500 mb-4",children:e.jsxs("div",{className:"flex justify-center relative",onClick:()=>a("/how-to-use"),children:[e.jsx(H,{size:24}),e.jsx("p",{className:"text-center ml-2",children:"如何使用"})]})})}export{T as B,X as M,Y as R};
