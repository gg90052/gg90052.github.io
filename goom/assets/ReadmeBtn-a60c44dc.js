import{r as i,b as w,j as e,d as j,c as O,h as k,f as I}from"./index-3d749199.js";import{G as F}from"./iconBase-7949b42f.js";import{b as R,e as D}from"./utils-545a1a06.js";import{b as N,c as v,d as b,e as S,D as f}from"./dialog-3debc61d.js";import{B as y}from"./index-e3f7be6b.js";import{u as L}from"./useDispatch-84b11c72.js";import{I as M}from"./input-3bad3d94.js";import{a as U}from"./index.esm-4268e967.js";function B(s){return F({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"m12 18 4-5h-3V2h-2v11H8z"}},{tag:"path",attr:{d:"M19 9h-4v2h4v9H5v-9h4V9H5c-1.103 0-2 .897-2 2v9c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-9c0-1.103-.897-2-2-2z"}}]})(s)}function V({setModalOpen:s,afterSave:d}){const[r,u]=i.useState("-1"),{mymaps:a,defaultMap:n}=w(t=>t.maps),c=L(),h=()=>{const t=n.data?n:JSON.parse(localStorage.getItem("tempNewMap")),o=R(t),l=JSON.parse(localStorage.getItem("tempLayer"));if(r==="-1")o.data=[...o.data,...l];else{const m=o.data.findIndex(p=>p.id===r);o.data[m].markers=[...o.data[m].markers,...l[0].markers]}if(a.length===0)c(j([o]));else{const m=a.map(p=>p.id===n.id?o:p);c(j(m))}c(O(o)),localStorage.removeItem("tempLayer"),localStorage.removeItem("tempNewMap"),s(!1),d&&d(r)};return e.jsx(e.Fragment,{children:e.jsxs(N,{className:"modalContent",children:[e.jsx(v,{children:e.jsx(b,{children:"匯入 / 新建圖層"})}),e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"text-sm text-slate-500 -mb-3",children:"選擇匯入圖層"}),e.jsxs("select",{className:"w-full h-10 border border-gray-300 rounded-md px-2",value:r,onChange:t=>u(t.target.value),children:[e.jsx("option",{value:"-1",children:"建立新圖層"}),n.data&&n.data.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx(S,{children:e.jsx(y,{type:"submit",onClick:h,children:"確定"})})]})})}function H({afterSave:s,setModalOpen:d}){const[r,u]=i.useState(""),a=()=>{const n={id:Date.now(),name:r,data:[]};localStorage.setItem("tempNewMap",JSON.stringify(n)),d(!1),s&&s()};return e.jsx(e.Fragment,{children:e.jsxs(N,{className:"modalContent",children:[e.jsx(v,{children:e.jsx(b,{children:"設定地圖名稱"})}),e.jsx(e.Fragment,{children:e.jsx(M,{type:"text",defaultValue:r,onChange:n=>u(n.target.value)})}),e.jsx(S,{children:e.jsx(y,{type:"submit",onClick:a,children:"建立新地圖"})})]})})}function z({afterSave:s,setModalOpen:d}){const[r,u]=k(),[a,n]=i.useState(r.get("mid")||""),[c,h]=i.useState(r.get("name")||""),t=i.useRef(),o=()=>{if(a===""){alert("請輸入我的地圖網址");return}else if((!a.includes("mid=")||!a.includes("google.com/maps/"))&&a.includes("https://")){n(""),alert("無法正確解析網址，請確認網址是否正確");return}const l=a.indexOf("mid=")>0?a.indexOf("mid=")+4:0,m=a.indexOf("&",l)>0?a.indexOf("&",l):a.length,p=a.substring(l,m);d(!1),s(p,c),u({})};return e.jsx(e.Fragment,{children:e.jsxs(N,{className:"modalContent",children:[e.jsx(v,{children:e.jsx(b,{children:"從我的地圖網址匯入..."})}),e.jsxs(e.Fragment,{children:[e.jsx("a",{className:"text-blue-500",href:"https://gg90052.github.io/blog/goom/",target:"_blank",rel:"noreferrer",children:"如何取得我的地圖網址？"}),e.jsx(M,{type:"text",placeholder:"請輸入我的地圖網址",defaultValue:a,onChange:l=>n(l.target.value)}),e.jsx(M,{type:"text",placeholder:"請輸入地圖名稱(選填)",ref:t,defaultValue:c,onChange:l=>h(l.target.value)})]}),e.jsx(S,{children:e.jsx(y,{type:"submit",onClick:o,children:"匯入地圖"})})]})})}const E=i.forwardRef(({type:s="import",size:d=24},r)=>{const[u,a]=i.useState(!1),[n,c]=i.useState(!1),[h,t]=i.useState(!1),{mymaps:o}=w(x=>x.maps),l=L(),m=I(),p=async(x,g)=>{const C=await D(x,g);l(O(C)),l(j([...o,C])),m("/")};return e.jsxs("div",{className:s==="full"?"w-full h-full absolute":"",children:[s==="import"&&e.jsx(B,{size:d,ref:r,onClick:()=>a(!0)}),s==="full"&&e.jsx("div",{className:"w-full h-full",ref:r,onClick:()=>a(!0)}),e.jsx(f,{open:u,onOpenChange:a,children:e.jsx(z,{afterSave:(x,g)=>p(x,g),setModalOpen:a})}),e.jsx(f,{open:n,onOpenChange:c,children:e.jsx(H,{afterSave:()=>t(!0),setModalOpen:c})}),e.jsx(f,{open:h,onOpenChange:t,children:e.jsx(V,{setModalOpen:t})})]})});E.displayName="MapUploader";function K(){const s=I();return e.jsx("button",{className:"w-full h-12 border-2 border-blue-500 text-blue-500 mb-4",children:e.jsxs("div",{className:"flex justify-center relative",onClick:()=>s("/how-to-use"),children:[e.jsx(U,{size:24}),e.jsx("p",{className:"text-center ml-2",children:"如何使用"})]})})}export{B,E as M,K as R};
