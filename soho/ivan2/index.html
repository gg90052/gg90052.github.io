<!DOCTYPE html>
<html lang="zh_tw">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Mi-Ne Gold</title>
	<link rel="stylesheet" href="css/main.css">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;400&display=swap" rel="stylesheet">
</head>

<body>
  <section class="home">
    <div class="slogan">熱銷突破千萬包，成長最快速*</div>
    <div class="stars"></div>
    <div id="gameStart" class="btn"></div>
    <p class="ps">*指黑七星軟包10毫克與7毫克之銷售；2021 NielsenlQ：建議零售價$135（含）以上之頂級價格帶</p>
  </section>
  <section class="q1">
    <div class="q">
      <img src="images/q1.png" alt="">
    </div>
    <div class="selects">
      <div class="option o1" val="1">
        峰系列
      </div>
      <div class="option o2" val="2">
        佳士達系列
      </div>
      <div class="option o3" val="3">
        黑七星系列
      </div>
    </div>
    <div class="star">
      <img src="images/star.png" alt="">
    </div>
    <div id="q1_ok" class="btn">
      <img src="images/btn_answer.png" alt="">
    </div>
  </section>
  <section class="q2">
    <div class="q">
      <img src="images/q2.png" alt="">
    </div>
    <div class="selects">
      <div class="option o1" val="1">
        黑七星軟包10毫克
      </div>
      <div class="option o2" val="2">
        黑七星7毫克
      </div>
      <div class="option o3" val="3">
        黑七星軟包4毫克
      </div>
      <div class="option o4" val="4">
        以上皆是
      </div>
    </div>
    <div class="star">
      <img src="images/star.png" alt="">
    </div>
    <div id="q2_ok" class="btn">
      <img src="images/btn_answer.png" alt="">
    </div>
  </section>
  <section class="q3">
    <div class="q">
      <img src="images/q3.png" alt="">
    </div>
    <div class="selects">
      <div class="option o1" val="1">
        130元
      </div>
      <div class="option o2" val="2">
        140元
      </div>
      <div class="option o3" val="3">
        150元
      </div>
    </div>
    <div class="star">
      <img src="images/star.png" alt="">
    </div>
    <div id="q3_ok" class="btn">
      <img src="images/btn_answer.png" alt="">
    </div>
  </section>
  <section class="end">
    <div id="gameEnd" class="btn">
      <img src="images/btn_gameover.png" alt="">
    </div>
  </section>
  <div class="warning">
    <img src="images/warning.jpg" alt="">
  </div>
  <div class="errorModal q1error flex center">
    <div class="content">
      <img src="images/q1_wrong.png" alt="">
    </div>
  </div>
  <div class="errorModal q2error flex center">
    <div class="content">
      <img src="images/q2_wrong.png" alt="">
    </div>
  </div>
  <div class="errorModal q3error flex center">
    <div class="content">
      <img src="images/q3_wrong.png" alt="">
    </div>
  </div>
  <div id="alreadyPlayed"></div>
  <script>
      document.documentElement.style.fontSize = document.documentElement.clientWidth / 11.25 + 'px';
  </script>
  <script src="js/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.4/axios.min.js"></script>
  <script src="https://www.road-to-app.com.tw/js/mgm.utils.min.js"></script>
  <script>
    var useApi = false;
    if (useApi === true){
      axios.get('/admin/index.php/api/permission_check', {
        headers:{
          'Authorization-Token':'Bearer '+MGMUtils.getToken()
        }
      }).then(res=>{
        const state = parseInt(res.data.state);
        if (state === 501){
          $('#alreadyPlayed').addClass('show');
        }else{
          $('.home').addClass('show');
        }
      });

      if (!MGMUtils.getToken()){
        redirect2Login();
      }else {
          // 遊戲開始
          $('#gameStart').bind('click', function(){
              axios.get('/admin/index.php/api/permission_check', {
                  headers:{
                      'Authorization-Token':'Bearer '+MGMUtils.getToken()
                  }
              }).then(res=>{
                  const state = parseInt(res.data.state);

                  switch (state) {
                      case 501: {
                        $('#alreadyPlayed').addClass('show');
                        msg = '已玩過'; break;
                      }
                      case 502: msg = 'token已失效'; break;
                      default : msg = res.data.msg;
                  }

                  if (state==1) {
                      gameStart();
                  } else if (state==502) {
                      redirect2Login();
                  } else {
                      console.log(res.data);
                      window.alert(msg);
                  }
              })

              return false;
          });

          // 遊戲結束
          $('#gameEnd').bind('click', function(){
              let formData = new FormData();
              formData.append('success', 1);

              axios.post('/admin/index.php/api/game_over', formData, {
                  headers:{
                      'Authorization-Token':'Bearer '+MGMUtils.getToken()
                  }
              }).then(res=>{
                  const state = parseInt(res.data.state);

                  switch (state) {
                      case 501: msg = '已玩過'; break;
                      case 502: msg = 'token已失效'; break;
                      default : msg = res.data.msg;
                  }

                  if (state==1) {
                      gameOver();
                  } else if (state==502) {
                      redirect2Login();
                  } else {
                      console.log(res.data);
                      window.alert('恭喜完成任務\n獎勵已透過簡訊發送');
                  }
              })

              return false;
          });
      }
    }else{
      $('body').addClass('dev');
      enterAnimation();
      $('#gameStart').bind('click', function(){
        gameStart();
      });
    }
    
    function enterAnimation(){
      $('.home').addClass('show');
      setTimeout(()=>{
        $('.home').addClass('show2');
      }, 2000);
    }

    function gameStart(){
      $('.home').removeClass('show2');
      $('.q1').addClass('show');
    };
    function gameOver(){
      window.alert('恭喜完成任務\n獎勵已透過簡訊發送');
    }
    function redirect2Login() {
      window.alert('請重新登入');
      const params = new URLSearchParams(window.location.search);
      window.location.href = 'https://www.road-to-app.com.tw?c=' + params.get('c');
    }
  
    $('.q1 .option').click(function(){
      $('.q1 .option').removeClass('active');
      $(this).addClass('active');
    });

    $('#q1_ok').click(function(){
      if ($('.q1 .option.active').attr('val') == 3){
        $('section').removeClass('show');
        $('.q2').addClass('show');
        $('.warning').addClass('hide');
      }else{
        $('.errorModal.q1error').addClass('show');
      }
    });

    $('.q2 .option').click(function(){
      $('.q2 .option').removeClass('active');
      $(this).addClass('active');
    });

    $('#q2_ok').click(function(){
      if ($('.q2 .option.active').attr('val') == 4){
        $('section').removeClass('show');
        $('.q3').addClass('show');
      }else{
        $('.errorModal.q2error').addClass('show');
      }
    });

    $('.q3 .option').click(function(){
      $('.q3 .option').removeClass('active');
      $(this).addClass('active');
    });

    $('#q3_ok').click(function(){
      if ($('.q3 .option.active').attr('val') == 2){
        $('section').removeClass('show');
        $('.end').addClass('show');
        $('.warning').removeClass('hide');
      }else{
        $('.errorModal.q3error').addClass('show');
      }
    });
    
    $('.errorModal').click(function(){
      $('.errorModal').removeClass('show');
    });
  </script>
</body>

</html>