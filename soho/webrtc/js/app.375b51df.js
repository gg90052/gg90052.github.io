(function(){"use strict";var e={980:function(e,n,o){var t=o(9242),r=o(3396),a=o(4870),i=o(440),s=o(8952);const c=(0,r._)("nav",null,null,-1);var l=(0,r.aZ)({__name:"App",setup(e){return(e,n)=>{const o=(0,r.up)("router-view");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.Wm)((0,a.SU)(i.l),{"safe-area-inset-top":""}),c,(0,r.Wm)(o),(0,r.Wm)((0,a.SU)(s.J),{"safe-area-inset-bottom":""})],64)}}});const u=l;var d=u,v=o(678),p=o(9852);const m=[{path:"/",component:p["default"]},{path:"/host",name:"LiveHost",component:()=>Promise.resolve().then(o.bind(o,9852))}],f=(0,v.p7)({history:(0,v.PO)(""),routes:m});var g=f;(0,t.ri)(d).use(g).mount("#app")},9852:function(e,n,o){o.r(n),o.d(n,{default:function(){return H}});var t=o(4870),r=o(3396),a=o(9242),i=o(7139),s=o(9545),c=o(3708),l=o(1113);const u=(e,n,o)=>(n.forEach(((t,r)=>{o?t[o]===e[o]&&n.splice(r,1):t===e&&n.splice(r,1)})),n);var d=o(5864);const v={style:{position:"relative","max-width":"390px",margin:"0 auto"}},p=["width","height",".srcObject"];var m=(0,r.aZ)({__name:"LiveVideo",emits:["onAir","onConnect"],setup(e,{expose:n,emit:o}){let a=(0,t.qj)({videoWidth:350,videoHeight:300,devices:[],stream:null,peer:null,id:null,live:null,isHost:!1,dataConn:[]});const s=e=>navigator.mediaDevices.getUserMedia(e),c=()=>new Promise((async(e,n)=>{if(a.devices.length>0)e(a.devices);else{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return console.log("webrtc is not supported!"),alert("您的設備不支援直播!"),void e([]);try{var o=await navigator.mediaDevices.enumerateDevices();a.devices=o,e(a.devices)}catch(t){console.error(t),e([])}}})),m=()=>new Promise((async(e,n)=>{a.stream&&a.stream.getTracks().forEach((e=>{e.stop()}));const o={audio:!1,video:{width:350,height:300}};a.stream=await s(o)})),f=()=>{a.peer.destroy(),a.peer=null},g=(e,n=!1,o=!1)=>{if(a.stream&&a.stream.getTracks().forEach((e=>{e.stop()})),n||o){const t={audio:o,video:n,facingMode:{exact:"environment"}};s(t).then((n=>{a.stream=n,e(n)}))}else e()},h=e=>{console.log("updated id:",e)},y=(e,n)=>{console.log("🚀 ~ onConnected "+n+" conn",e)},w=e=>{console.log("🚀 ~ onDisconnected conn",e),o("onAir",!1),o("onConnect",!1)},C=(e,n)=>{console.log("🚀 ~ onRecv msg",e,n)},b=e=>{console.log("🚀 ~ onRemoteStream stream",e),a.stream=e},_=async(e,n=!1)=>{if(""===e)return d.V.alert({message:"請輸入房間ID"}),!1;a.isHost=n;const t=a.isHost?e:null;let r={host:"project-id-3749215199352866047.wl.r.appspot.com",port:443,path:"/"};var i=new l.ZP(t,r);a.peer=i,i.on("open",(n=>{if(console.log("register success. "+n),a.id=n,h(n),a.isHost)o("onAir",!0);else{var t=()=>{var n=i.connect(e);n.on("open",(()=>{a.dataConn.push(n),y(n,"client")})),n.on("close",(()=>{a.dataConn=u(n,a.dataConn,"connectionId"),w(n)})),n.on("data",(e=>{console.log("RTC RECV: "+e);const o=JSON.parse(e);C(o,n)})),i.call(e,a.stream)};g(t,!0,!0)}})),i.on("disconnected",(()=>{console.log("Connection lost. Please reconnect"),o("onAir",!1)})),i.on("close",(()=>{console.log("Connection destroyed")})),i.on("error",(e=>{console.log(e),d.V.alert({message:"無法連線至房間"})})),i.on("call",(e=>{e.answer(a.stream),e.on("stream",(n=>{console.log("received remote stream"),a.isHost?i.call(e.peer,a.stream):(o("onConnect",!0),b(n))}))})),i.on("connection",(e=>{console.log("Host Connection connected"),a.dataConn.push(e),y(e,"host"),e.on("close",(()=>{console.log("Host Connection closed"),a.dataConn=u(e,a.dataConn,"connectionId"),w(e)})),e.on("data",(n=>{console.log("Host RTC RECV: "+n);var o=JSON.parse(n);C(o,e)}))}))},k=()=>a.dataConn.length;return n({getDevices:c,startLive:m,stopLive:f,onIDUpdated:h,onConnected:y,onDisconnected:w,onRecv:C,onRemoteStream:b,connectWebRTC:_,getCount:k}),(e,n)=>((0,r.wg)(),(0,r.iD)("div",v,[(0,r._)("p",{class:(0,i.C_)([(0,t.SU)(a).peer&&(0,t.SU)(a).isHost?"show":"","onAir"])},"On Air",2),(0,r._)("video",{playsinline:"",autoplay:"",width:(0,t.SU)(a).videoWidth,height:(0,t.SU)(a).videoHeight,".srcObject":(0,t.SU)(a).stream},null,8,p)]))}}),f=o(89);const g=(0,f.Z)(m,[["__scopeId","data-v-677b7695"]]);var h=g;const y=e=>((0,r.dD)("data-v-4a893f34"),e=e(),(0,r.Cn)(),e),w={key:0},C=(0,r.Uk)("開啟視訊鏡頭"),b=(0,r.Uk)("開始直播"),_=(0,r.Uk)("結束直播"),k={key:0},D=y((()=>(0,r._)("br",null,null,-1))),O=(0,r.Uk)("進入房間");var S=(0,r.aZ)({__name:"Host",setup(e){const n=(0,t.qj)({roomID:"",liveCount:0,cameraReady:!1,onAir:!1,isConnect:!1}),o=(0,t.iH)(),l=(0,t.iH)();const u=async()=>{n.cameraReady=!0,await o.value.startLive()},d=async()=>{await o.value.connectWebRTC(n.roomID,!0)},v=async()=>{await o.value.stopLive()},p=async()=>{await l.value.connectWebRTC(n.roomID)},m=e=>{console.log("onAir",e),n.onAir=e},f=e=>{n.isConnect=e};return(e,g)=>((0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r.wy)((0,r.Wm)(h,{ref_key:"hostVideo",ref:o,onOnAir:m},null,512),[[a.F8,n.cameraReady]]),(0,r.Wm)(h,{class:(0,i.C_)(n.isConnect?"":"hide"),ref_key:"clientVideo",ref:l,onOnConnect:f},null,8,["class"]),(0,r._)("div",null,[n.onAir?((0,r.wg)(),(0,r.iD)("p",w,"觀看人數："+(0,i.zw)(n.liveCount),1)):(0,r.kq)("",!0),n.cameraReady?(0,r.kq)("",!0):((0,r.wg)(),(0,r.j4)((0,t.SU)(s.z),{key:1,onClick:u,type:"primary"},{default:(0,r.w5)((()=>[C])),_:1})),n.cameraReady&&!1===n.onAir?((0,r.wg)(),(0,r.j4)((0,t.SU)(s.z),{key:2,onClick:d,type:"primary"},{default:(0,r.w5)((()=>[b])),_:1})):(0,r.kq)("",!0),n.onAir?((0,r.wg)(),(0,r.j4)((0,t.SU)(s.z),{key:3,onClick:v,type:"danger"},{default:(0,r.w5)((()=>[_])),_:1})):(0,r.kq)("",!0)]),n.isConnect?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("div",k,[(0,r.Wm)((0,t.SU)(c.g),{modelValue:n.roomID,"onUpdate:modelValue":g[0]||(g[0]=e=>n.roomID=e),label:"房間ID"},null,8,["modelValue"]),D,(0,r.Wm)((0,t.SU)(s.z),{onClick:p,type:"primary"},{default:(0,r.w5)((()=>[O])),_:1})]))],64))}});const U=(0,f.Z)(S,[["__scopeId","data-v-4a893f34"]]);var H=U}},n={};function o(t){var r=n[t];if(void 0!==r)return r.exports;var a=n[t]={exports:{}};return e[t](a,a.exports,o),a.exports}o.m=e,function(){var e=[];o.O=function(n,t,r,a){if(!t){var i=1/0;for(u=0;u<e.length;u++){t=e[u][0],r=e[u][1],a=e[u][2];for(var s=!0,c=0;c<t.length;c++)(!1&a||i>=a)&&Object.keys(o.O).every((function(e){return o.O[e](t[c])}))?t.splice(c--,1):(s=!1,a<i&&(i=a));if(s){e.splice(u--,1);var l=r();void 0!==l&&(n=l)}}return n}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[t,r,a]}}(),function(){o.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(n,{a:n}),n}}(),function(){o.d=function(e,n){for(var t in n)o.o(n,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};o.O.j=function(n){return 0===e[n]};var n=function(n,t){var r,a,i=t[0],s=t[1],c=t[2],l=0;if(i.some((function(n){return 0!==e[n]}))){for(r in s)o.o(s,r)&&(o.m[r]=s[r]);if(c)var u=c(o)}for(n&&n(t);l<i.length;l++)a=i[l],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(u)},t=self["webpackChunkvite_webpack_ts"]=self["webpackChunkvite_webpack_ts"]||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))}();var t=o.O(void 0,[998],(function(){return o(980)}));t=o.O(t)})();
//# sourceMappingURL=app.375b51df.js.map